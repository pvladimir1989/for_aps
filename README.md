Тестовое задание APS

## Задание

### Общее описание

Необходимо написать очень простой поисковик по текстам документов.
Данные хранятся в БД по желанию, поисковый индекс в эластике.
[Тестовые данные](https://api.onedrive.com/v1.0/shares/u!aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBdldqdXEtLW5zblNrYW8yUzVzMnpUTHpNMHBweHc_ZT1RQnJIMGQ/root/content)

### Структура БД

- `id` - уникальный для каждого документа
- `rubrics` - массив рубрик
- `text` - текст документа
- `created_date` - дата создания документа

### Структура Индекса

- `id` - id из базы
- `text` - текст из структуры БД

### Необходимые методы

- сервис должен принимать на вход произвольный текстовый запрос, искать по тексту документа в индексе и возвращать первые 20 документов со всем полями БД, упорядоченные по дате создания
- удалять документ из БД и индекса по полю  `id`

### Технические требования

- Любой Python фреймворк кроме Django и DRF
- `README` с гайдом по поднятию
- `docs.json` - документация к сервису в формате OpenAPI

### Программа максимум

- функциональные тесты
- сервис работает в Docker
- асинхронные вызовы


## Запуск проекта

- git clone https://github.com/pvladimir1989/for_aps.git
- файл .example_env переименовываем в .env
- для увеличения виртуальной памяти (для elasticsearch) на 
linux используем команду **sudo sysctl -w vm.max_map_count=262144**
- из корня проекта запускаем **docker-compose up --build**

## Создаем БД

- Заходим в докер контейнер **docker exec -it for_aps_web_1 /bin/bash**
- **cd utils** 
- **python csv_to_db.py**
- Подключится БД


## Пример запроса/удаления

- http://0.0.0.0:8000/get_posts?query=давай
- http://0.0.0.0:8000/delete_post?id=4

## Технологии

- Postgres
- Elasticsearch
- Docker
- Flask

## Проблемы

- Не удалось сделать асинхронные запросы к БД. Flask в базовой комплектации
не поддерживает asgi. Возможно, по этой причине AsyncElasticsearch давал ошибку.
Пытался сделать внешнюю обертку над Flask с помощью Quart и asyncio, 
но тоже не вышло. 
- Наверное, для асинхронных задач легче было бы использовать fastapi



